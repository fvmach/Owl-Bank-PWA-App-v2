import{Box,safelySpreadBoxProps}from"@twilio-paste/box";import{useUID}from"@twilio-paste/uid-library";import*as React2 from"react";import*as React from"react";var AIMessageContext=React.createContext({});var AIChatMessage=React2.forwardRef(({children,element="AI_CHAT_MESSAGE",variant,id,...props},ref)=>{let AIChatMessageId=id||useUID();return React2.createElement(AIMessageContext.Provider,{value:{variant,id:AIChatMessageId}},React2.createElement(Box,{role:"listitem",display:"flex",flexDirection:"column",rowGap:"space40",ref,element,...safelySpreadBoxProps(props)},children))});AIChatMessage.displayName="AIChatMessage";import{Box as Box2,safelySpreadBoxProps as safelySpreadBoxProps2}from"@twilio-paste/box";import*as React3 from"react";var AIChatMessageActionGroup=React3.forwardRef(({children,element="AI_CHAT_MESSAGE_ACTION_GROUP",...props},ref)=>React3.createElement(Box2,{...safelySpreadBoxProps2(props),ref,element,display:"flex",flexWrap:"wrap",alignItems:"center",columnGap:"space40",fontWeight:"fontWeightMedium",marginTop:"space40"},children));AIChatMessageActionGroup.displayName="AIChatMessageActionGroup";import{Box as Box3,safelySpreadBoxProps as safelySpreadBoxProps3}from"@twilio-paste/box";import*as React5 from"react";import React4,{useEffect,useState}from"react";var useAnimatedText=(children,speed=10,enabled=!0)=>{let[animatedChildren,setAnimatedChildren]=useState(),[textIndex,setTextIndex]=useState(0);useEffect(()=>{let interval=setInterval(()=>{setTextIndex(prevIndex=>prevIndex+1)},speed);return()=>clearInterval(interval)},[speed]);let calculateTotalTextLength=nodes=>{let length=0;return React4.Children.forEach(nodes,child=>{typeof child=="string"?length+=child.length:React4.isValidElement(child)&&(length+=calculateTotalTextLength(child.props.children))}),length},cloneChildren=(nodes,currentIndex)=>{let currentTextIndex=currentIndex;return React4.Children.map(nodes,child=>{if(typeof child=="string"){if(currentTextIndex>0){let visibleText=child.slice(0,currentTextIndex);return currentTextIndex-=child.length,visibleText}return null}else if(React4.isValidElement(child)){let totalChildTextLength=calculateTotalTextLength(child.props.children);if(currentTextIndex>0){let clonedChild=React4.cloneElement(child,{},cloneChildren(child.props.children,currentTextIndex));return currentTextIndex-=totalChildTextLength,clonedChild}else if(currentTextIndex===0&&totalChildTextLength===0)return child;return null}return child})};return useEffect(()=>{if(enabled){let totaLength=calculateTotalTextLength(children);textIndex<=totaLength&&setAnimatedChildren(cloneChildren(children,textIndex))}},[children,textIndex,enabled]),{animatedChildren:enabled?animatedChildren:children,isAnimating:enabled&&textIndex<calculateTotalTextLength(children)}};var Sizes={default:{fontSize:"fontSize30",lineHeight:"lineHeight30"},fullScreen:{fontSize:"fontSize40",lineHeight:"lineHeight40"}},AIChatMessageBody=React5.forwardRef(({children,size="default",element="AI_CHAT_MESSAGE_BODY",animated:animated2=!1,onAnimationEnd,onAnimationStart,...props},ref)=>{let{id}=React5.useContext(AIMessageContext),[showAnimation]=React5.useState(animated2&&children!==void 0),animationSpeed=size==="fullScreen"?8:10,{animatedChildren,isAnimating}=useAnimatedText(children,animationSpeed,showAnimation);return React5.useEffect(()=>{onAnimationStart&&animated2&&isAnimating&&onAnimationStart(),animated2&&!isAnimating&&onAnimationEnd&&onAnimationEnd()},[isAnimating,showAnimation]),React5.createElement(Box3,{...safelySpreadBoxProps3(props),...Sizes[size],display:"inline-block",color:"colorText",wordWrap:"break-word",maxWidth:"100%",minWidth:0,element,ref,whiteSpace:"pre-wrap",id},animatedChildren)});AIChatMessageBody.displayName="AIChatMessageBody";import{Avatar}from"@twilio-paste/avatar";import{Box as Box4,safelySpreadBoxProps as safelySpreadBoxProps4}from"@twilio-paste/box";import{ArtificialIntelligenceIcon}from"@twilio-paste/icons/esm/ArtificialIntelligenceIcon";import*as React6 from"react";var AIChatMessageAuthor=React6.forwardRef(({children,element="AI_CHAT_MESSAGE_AUTHOR",avatarName,avatarIcon,avatarSrc,...props},ref)=>{let{variant}=React6.useContext(AIMessageContext);return React6.createElement(Box4,{...safelySpreadBoxProps4(props),ref,"aria-label":props["aria-label"],element,display:"flex",alignItems:"center",columnGap:"space40",fontWeight:"fontWeightMedium"},variant==="bot"?React6.createElement(Avatar,{name:children,size:"sizeIcon50",color:"decorative20",icon:ArtificialIntelligenceIcon,element:`${element}_BOT_AVATAR`}):React6.createElement(Avatar,{size:"sizeIcon50",color:"decorative30",element:`${element}_USER_AVATAR`,name:avatarName||children,icon:avatarIcon,src:avatarSrc}),children)});AIChatMessageAuthor.displayName="AIChatMessageAuthor";import{Box as Box5,safelySpreadBoxProps as safelySpreadBoxProps5}from"@twilio-paste/box";import*as React7 from"react";var AIChatMessageActionCard=React7.forwardRef(({children,element="AI_CHAT_MESSAGE_ACTION_CARD",...props},ref)=>React7.createElement(Box5,{...safelySpreadBoxProps5(props),ref,element,display:"inline-flex",alignItems:"flex-start",columnGap:"space30",color:"colorTextIcon",lineHeight:"lineHeight30",fontSize:"fontSize30",fontWeight:"fontWeightMedium",backgroundColor:"colorBackgroundBody",boxShadow:"shadowBorderWeaker",borderRadius:"borderRadius30",paddingX:"space30",paddingY:"space20"},children));AIChatMessageActionCard.displayName="AIChatMessageActionCard";import{Box as Box6,safelySpreadBoxProps as safelySpreadBoxProps6}from"@twilio-paste/box";import{Button}from"@twilio-paste/button";import{StopIcon}from"@twilio-paste/icons/esm/StopIcon";import{ScreenReaderOnly}from"@twilio-paste/screen-reader-only";import{SkeletonLoader}from"@twilio-paste/skeleton-loader";import*as React8 from"react";var clampedRandom=(min,max)=>Math.min(Math.max(min,Math.random()*max),max),AIChatMessageLoading=React8.forwardRef(({onStopLoading,i18nStopGeneratingLabel="Stop generating",i18nAIScreenReaderText="AI response",element="AI_CHAT_MESSAGE_LOADING",...props},ref)=>{let widths=React8.useRef([clampedRandom(40,75),clampedRandom(65,100),clampedRandom(55,80)]).current,{id:messageBodyID}=React8.useContext(AIMessageContext);return React8.createElement(Box6,{...safelySpreadBoxProps6(props),ref,element,display:"flex",flexDirection:"column",rowGap:"space40"},React8.createElement(SkeletonLoader,{width:`${widths[0]}%`,height:"20px",element:`${element}_SKELETON`}),React8.createElement(SkeletonLoader,{width:`${widths[1]}%`,height:"20px",element:`${element}_SKELETON`}),React8.createElement(SkeletonLoader,{width:`${widths[2]}%`,height:"20px",element:`${element}_SKELETON`}),onStopLoading?React8.createElement(Box6,{display:"flex",justifyContent:"center",element:`${element}_STOP_LOADING`},React8.createElement(Button,{variant:"secondary",size:"rounded_small",onClick:onStopLoading,"aria-controls":messageBodyID,element:`${element}_STOP_BUTTON`},React8.createElement(StopIcon,{decorative:!0}),i18nStopGeneratingLabel," ",React8.createElement(ScreenReaderOnly,null,i18nAIScreenReaderText))):null)});AIChatMessageLoading.displayName="AIChatMessageLoading";import{Box as Box7,safelySpreadBoxProps as safelySpreadBoxProps7}from"@twilio-paste/box";import*as React9 from"react";var AIChatLog=React9.forwardRef(({element="AI_CHAT_LOG",children,...props},ref)=>React9.createElement(Box7,{role:"log",paddingY:"space70",element,ref,...safelySpreadBoxProps7(props)},React9.createElement(Box7,{as:"div",role:"list",margin:"space0",padding:"space0",display:"flex",flexDirection:"column",rowGap:"space130",element:`${element}_LIST`},children)));AIChatLog.displayName="AIChatLog";import{uid}from"@twilio-paste/uid-library";import*as React10 from"react";var aiChatWithId=chat=>({...chat,id:chat.id||uid(chat.content)}),useAIChatLogger=(...initialChats)=>{let parsedInitialChats=React10.useMemo(()=>initialChats.map(aiChatWithId),[initialChats]),[aiChats,setAIChats]=React10.useState(parsedInitialChats),push=React10.useCallback(next=>{setAIChats(prev=>prev.concat(aiChatWithId(next)))},[]),pop=React10.useCallback(id=>{setAIChats(prev=>id?prev.filter(chat=>chat.id!==id):prev.slice(0,-1))},[]),clear=React10.useCallback(()=>setAIChats([]),[]);return{push,pop,aiChats,clear}};import{animated,useReducedMotion,useTransition}from"@twilio-paste/animation-library";import{Box as Box8}from"@twilio-paste/box";import*as React11 from"react";var AnimatedAI=animated(Box8),AIChatLogger=React11.forwardRef(({aiChats,...props},ref)=>{let transitions=useTransition(aiChats,{keys:AIChat=>AIChat.id,from:()=>({opacity:0,x:0}),enter:{opacity:1,x:0},leave:()=>({opacity:0,x:0}),config:{mass:.7,tension:190,friction:16}}),animatedAIs=useReducedMotion()?aiChats.map(AIChat=>React11.cloneElement(AIChat.content,{key:AIChat.id})):transitions((styles,AIChat,{key})=>React11.createElement(AnimatedAI,{as:"div",style:styles,key},AIChat.content));return React11.createElement(AIChatLog,{...props,ref},animatedAIs)});AIChatLogger.displayName="AIChatLogger";export{AIChatLog,AIChatLogger,AIChatMessage,AIChatMessageActionCard,AIChatMessageActionGroup,AIChatMessageAuthor,AIChatMessageBody,AIChatMessageLoading,useAIChatLogger};
