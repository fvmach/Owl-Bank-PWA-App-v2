"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/index.tsx
var src_exports = {};
__export(src_exports, {
  AIChatLog: () => AIChatLog,
  AIChatLogger: () => AIChatLogger,
  AIChatMessage: () => AIChatMessage,
  AIChatMessageActionCard: () => AIChatMessageActionCard,
  AIChatMessageActionGroup: () => AIChatMessageActionGroup,
  AIChatMessageAuthor: () => AIChatMessageAuthor,
  AIChatMessageBody: () => AIChatMessageBody,
  AIChatMessageLoading: () => AIChatMessageLoading,
  useAIChatLogger: () => useAIChatLogger
});
module.exports = __toCommonJS(src_exports);

// src/AIChatMessage.tsx
var import_box = require("@twilio-paste/box");
var import_uid_library = require("@twilio-paste/uid-library");
var React2 = __toESM(require("react"));

// src/AIMessageContext.tsx
var React = __toESM(require("react"));
var AIMessageContext = React.createContext({});

// src/AIChatMessage.tsx
var AIChatMessage = React2.forwardRef(
  ({ children, element = "AI_CHAT_MESSAGE", variant, id, ...props }, ref) => {
    const AIChatMessageId = id || (0, import_uid_library.useUID)();
    return /* @__PURE__ */ React2.createElement(AIMessageContext.Provider, { value: { variant, id: AIChatMessageId } }, /* @__PURE__ */ React2.createElement(
      import_box.Box,
      {
        role: "listitem",
        display: "flex",
        flexDirection: "column",
        rowGap: "space40",
        ref,
        element,
        ...(0, import_box.safelySpreadBoxProps)(props)
      },
      children
    ));
  }
);
AIChatMessage.displayName = "AIChatMessage";

// src/AIChatMessageActionGroup.tsx
var import_box2 = require("@twilio-paste/box");
var React3 = __toESM(require("react"));
var AIChatMessageActionGroup = React3.forwardRef(
  ({ children, element = "AI_CHAT_MESSAGE_ACTION_GROUP", ...props }, ref) => {
    return /* @__PURE__ */ React3.createElement(
      import_box2.Box,
      {
        ...(0, import_box2.safelySpreadBoxProps)(props),
        ref,
        element,
        display: "flex",
        flexWrap: "wrap",
        alignItems: "center",
        columnGap: "space40",
        fontWeight: "fontWeightMedium",
        marginTop: "space40"
      },
      children
    );
  }
);
AIChatMessageActionGroup.displayName = "AIChatMessageActionGroup";

// src/AIChatMessageBody.tsx
var import_box3 = require("@twilio-paste/box");
var React5 = __toESM(require("react"));

// src/utils.tsx
var import_react = __toESM(require("react"));
var useAnimatedText = (children, speed = 10, enabled = true) => {
  const [animatedChildren, setAnimatedChildren] = (0, import_react.useState)();
  const [textIndex, setTextIndex] = (0, import_react.useState)(0);
  (0, import_react.useEffect)(() => {
    const interval = setInterval(() => {
      setTextIndex((prevIndex) => prevIndex + 1);
    }, speed);
    return () => clearInterval(interval);
  }, [speed]);
  const calculateTotalTextLength = (nodes) => {
    let length = 0;
    import_react.default.Children.forEach(nodes, (child) => {
      if (typeof child === "string") {
        length += child.length;
      } else if (import_react.default.isValidElement(child)) {
        length += calculateTotalTextLength(child.props.children);
      }
    });
    return length;
  };
  const cloneChildren = (nodes, currentIndex) => {
    let currentTextIndex = currentIndex;
    return import_react.default.Children.map(nodes, (child) => {
      if (typeof child === "string") {
        if (currentTextIndex > 0) {
          const visibleText = child.slice(0, currentTextIndex);
          currentTextIndex -= child.length;
          return visibleText;
        }
        return null;
      } else if (import_react.default.isValidElement(child)) {
        const totalChildTextLength = calculateTotalTextLength(child.props.children);
        if (currentTextIndex > 0) {
          const clonedChild = import_react.default.cloneElement(child, {}, cloneChildren(child.props.children, currentTextIndex));
          currentTextIndex -= totalChildTextLength;
          return clonedChild;
        } else if (currentTextIndex === 0 && totalChildTextLength === 0) {
          return child;
        }
        return null;
      }
      return child;
    });
  };
  (0, import_react.useEffect)(() => {
    if (enabled) {
      const totaLength = calculateTotalTextLength(children);
      if (textIndex <= totaLength) {
        setAnimatedChildren(cloneChildren(children, textIndex));
      }
    }
  }, [children, textIndex, enabled]);
  return {
    animatedChildren: enabled ? animatedChildren : children,
    isAnimating: enabled && textIndex < calculateTotalTextLength(children)
  };
};

// src/AIChatMessageBody.tsx
var Sizes = {
  default: {
    fontSize: "fontSize30",
    lineHeight: "lineHeight30"
  },
  fullScreen: {
    fontSize: "fontSize40",
    lineHeight: "lineHeight40"
  }
};
var AIChatMessageBody = React5.forwardRef(
  ({
    children,
    size = "default",
    element = "AI_CHAT_MESSAGE_BODY",
    animated: animated2 = false,
    onAnimationEnd,
    onAnimationStart,
    ...props
  }, ref) => {
    const { id } = React5.useContext(AIMessageContext);
    const [showAnimation] = React5.useState(animated2 && children !== void 0);
    const animationSpeed = size === "fullScreen" ? 8 : 10;
    const { animatedChildren, isAnimating } = useAnimatedText(children, animationSpeed, showAnimation);
    React5.useEffect(() => {
      if (onAnimationStart && animated2 && isAnimating) {
        onAnimationStart();
      }
      if (animated2 && !isAnimating && onAnimationEnd) {
        onAnimationEnd();
      }
    }, [isAnimating, showAnimation]);
    return /* @__PURE__ */ React5.createElement(
      import_box3.Box,
      {
        ...(0, import_box3.safelySpreadBoxProps)(props),
        ...Sizes[size],
        display: "inline-block",
        color: "colorText",
        wordWrap: "break-word",
        maxWidth: "100%",
        minWidth: 0,
        element,
        ref,
        whiteSpace: "pre-wrap",
        id
      },
      animatedChildren
    );
  }
);
AIChatMessageBody.displayName = "AIChatMessageBody";

// src/AIChatMessageAuthor.tsx
var import_avatar = require("@twilio-paste/avatar");
var import_box4 = require("@twilio-paste/box");
var import_ArtificialIntelligenceIcon = require("@twilio-paste/icons/cjs/ArtificialIntelligenceIcon");
var React6 = __toESM(require("react"));
var AIChatMessageAuthor = React6.forwardRef(
  ({ children, element = "AI_CHAT_MESSAGE_AUTHOR", avatarName, avatarIcon, avatarSrc, ...props }, ref) => {
    const { variant } = React6.useContext(AIMessageContext);
    return /* @__PURE__ */ React6.createElement(
      import_box4.Box,
      {
        ...(0, import_box4.safelySpreadBoxProps)(props),
        ref,
        "aria-label": props["aria-label"],
        element,
        display: "flex",
        alignItems: "center",
        columnGap: "space40",
        fontWeight: "fontWeightMedium"
      },
      variant === "bot" ? /* @__PURE__ */ React6.createElement(
        import_avatar.Avatar,
        {
          name: children,
          size: "sizeIcon50",
          color: "decorative20",
          icon: import_ArtificialIntelligenceIcon.ArtificialIntelligenceIcon,
          element: `${element}_BOT_AVATAR`
        }
      ) : /* @__PURE__ */ React6.createElement(
        import_avatar.Avatar,
        {
          size: "sizeIcon50",
          color: "decorative30",
          element: `${element}_USER_AVATAR`,
          name: avatarName || children,
          icon: avatarIcon,
          src: avatarSrc
        }
      ),
      children
    );
  }
);
AIChatMessageAuthor.displayName = "AIChatMessageAuthor";

// src/AIChatMessageActionCard.tsx
var import_box5 = require("@twilio-paste/box");
var React7 = __toESM(require("react"));
var AIChatMessageActionCard = React7.forwardRef(
  ({ children, element = "AI_CHAT_MESSAGE_ACTION_CARD", ...props }, ref) => /* @__PURE__ */ React7.createElement(
    import_box5.Box,
    {
      ...(0, import_box5.safelySpreadBoxProps)(props),
      ref,
      element,
      display: "inline-flex",
      alignItems: "flex-start",
      columnGap: "space30",
      color: "colorTextIcon",
      lineHeight: "lineHeight30",
      fontSize: "fontSize30",
      fontWeight: "fontWeightMedium",
      backgroundColor: "colorBackgroundBody",
      boxShadow: "shadowBorderWeaker",
      borderRadius: "borderRadius30",
      paddingX: "space30",
      paddingY: "space20"
    },
    children
  )
);
AIChatMessageActionCard.displayName = "AIChatMessageActionCard";

// src/AIChatMessageLoading.tsx
var import_box6 = require("@twilio-paste/box");
var import_button = require("@twilio-paste/button");
var import_StopIcon = require("@twilio-paste/icons/cjs/StopIcon");
var import_screen_reader_only = require("@twilio-paste/screen-reader-only");
var import_skeleton_loader = require("@twilio-paste/skeleton-loader");
var React8 = __toESM(require("react"));
var clampedRandom = (min, max) => {
  return Math.min(Math.max(min, Math.random() * max), max);
};
var AIChatMessageLoading = React8.forwardRef(
  ({
    onStopLoading,
    i18nStopGeneratingLabel = "Stop generating",
    i18nAIScreenReaderText = "AI response",
    element = "AI_CHAT_MESSAGE_LOADING",
    ...props
  }, ref) => {
    const widths = React8.useRef([clampedRandom(40, 75), clampedRandom(65, 100), clampedRandom(55, 80)]).current;
    const { id: messageBodyID } = React8.useContext(AIMessageContext);
    return /* @__PURE__ */ React8.createElement(
      import_box6.Box,
      {
        ...(0, import_box6.safelySpreadBoxProps)(props),
        ref,
        element,
        display: "flex",
        flexDirection: "column",
        rowGap: "space40"
      },
      /* @__PURE__ */ React8.createElement(import_skeleton_loader.SkeletonLoader, { width: `${widths[0]}%`, height: "20px", element: `${element}_SKELETON` }),
      /* @__PURE__ */ React8.createElement(import_skeleton_loader.SkeletonLoader, { width: `${widths[1]}%`, height: "20px", element: `${element}_SKELETON` }),
      /* @__PURE__ */ React8.createElement(import_skeleton_loader.SkeletonLoader, { width: `${widths[2]}%`, height: "20px", element: `${element}_SKELETON` }),
      onStopLoading ? /* @__PURE__ */ React8.createElement(import_box6.Box, { display: "flex", justifyContent: "center", element: `${element}_STOP_LOADING` }, /* @__PURE__ */ React8.createElement(
        import_button.Button,
        {
          variant: "secondary",
          size: "rounded_small",
          onClick: onStopLoading,
          "aria-controls": messageBodyID,
          element: `${element}_STOP_BUTTON`
        },
        /* @__PURE__ */ React8.createElement(import_StopIcon.StopIcon, { decorative: true }),
        i18nStopGeneratingLabel,
        " ",
        /* @__PURE__ */ React8.createElement(import_screen_reader_only.ScreenReaderOnly, null, i18nAIScreenReaderText)
      )) : null
    );
  }
);
AIChatMessageLoading.displayName = "AIChatMessageLoading";

// src/AIChatLog.tsx
var import_box7 = require("@twilio-paste/box");
var React9 = __toESM(require("react"));
var AIChatLog = React9.forwardRef(
  ({ element = "AI_CHAT_LOG", children, ...props }, ref) => {
    return /* @__PURE__ */ React9.createElement(import_box7.Box, { role: "log", paddingY: "space70", element, ref, ...(0, import_box7.safelySpreadBoxProps)(props) }, /* @__PURE__ */ React9.createElement(
      import_box7.Box,
      {
        as: "div",
        role: "list",
        margin: "space0",
        padding: "space0",
        display: "flex",
        flexDirection: "column",
        rowGap: "space130",
        element: `${element}_LIST`
      },
      children
    ));
  }
);
AIChatLog.displayName = "AIChatLog";

// src/useAIChatLogger.tsx
var import_uid_library2 = require("@twilio-paste/uid-library");
var React10 = __toESM(require("react"));
var aiChatWithId = (chat) => ({ ...chat, id: chat.id || (0, import_uid_library2.uid)(chat.content) });
var useAIChatLogger = (...initialChats) => {
  const parsedInitialChats = React10.useMemo(() => initialChats.map(aiChatWithId), [initialChats]);
  const [aiChats, setAIChats] = React10.useState(parsedInitialChats);
  const push = React10.useCallback((next) => {
    setAIChats((prev) => prev.concat(aiChatWithId(next)));
  }, []);
  const pop = React10.useCallback((id) => {
    setAIChats((prev) => id ? prev.filter((chat) => chat.id !== id) : prev.slice(0, -1));
  }, []);
  const clear = React10.useCallback(() => setAIChats([]), []);
  return { push, pop, aiChats, clear };
};

// src/AIChatLogger.tsx
var import_animation_library = require("@twilio-paste/animation-library");
var import_box8 = require("@twilio-paste/box");
var React11 = __toESM(require("react"));
var AnimatedAI = (0, import_animation_library.animated)(import_box8.Box);
var AIChatLogger = React11.forwardRef(({ aiChats, ...props }, ref) => {
  const transitions = (0, import_animation_library.useTransition)(aiChats, {
    keys: (AIChat) => AIChat.id,
    from: () => ({ opacity: 0, x: 0 }),
    enter: { opacity: 1, x: 0 },
    leave: () => ({ opacity: 0, x: 0 }),
    config: {
      mass: 0.7,
      tension: 190,
      friction: 16
    }
  });
  const animatedAIs = (0, import_animation_library.useReducedMotion)() ? aiChats.map((AIChat) => React11.cloneElement(AIChat.content, { key: AIChat.id })) : transitions((styles, AIChat, { key }) => /* @__PURE__ */ React11.createElement(AnimatedAI, { as: "div", style: styles, key }, AIChat.content));
  return /* @__PURE__ */ React11.createElement(AIChatLog, { ...props, ref }, animatedAIs);
});
AIChatLogger.displayName = "AIChatLogger";
